from gmpy2 import mpz, isqrt, invert, digits, powmod

def main():
    print("Q1:", challenge1())
    print("Q2:", challenge2())
    print("Q3:", challenge3())
    print("Q4:", challenge4())

def challenge1():
    n = mpz('17976931348623159077293051907890247336179769789423065727343008115' + 
            '77326758055056206869853794492129829595855013875371640157101398586' +
            '47833778606925583497541085196591615128057575940752635007475935288' +
            '71082364994994077189561705436114947486504671101510156394068052754' +
            '0071584560878577663743040086340742855278549092581')

    a = isqrt(n) + 1

    return a - isqrt(a**2 - n)


def challenge2():
    n = mpz('6484558428080716696628242653467722787263437207069762630604390703787' +
            '9730861808111646271401527606141756919558732184025452065542490671989' +
            '2428844841839353281972988531310511738648965962582821502504990264452' +
            '1008852816733037111422964210278402893076574586452336833570778346897' +
            '15838646088239640236866252211790085787877')

    a = isqrt(n)

    while True:
        try:
            x = isqrt(a**2 - n)
            if n == (a - x) * (a + x):
                break

        except ValueError:
            pass
        

        a += 1

    return a - x


def challenge3():
    n = mpz('72006226374735042527956443552558373833808445147399984182665305798191' + 
            '63556901883377904234086641876639384851752649940178970835240791356868' +
            '77441155132015188279331812309091996246361896836573643119174094961348' +
            '52463970788523879939683923036467667022162701835329944324119217381272' +
            '9276147530748597302192751375739387929')
    
    a_ = isqrt(n * 24) + 1
    
    d = (a_**2) - 24*n

    assert d > 0

    p = (a_ - isqrt(d)) // 6

    return min(p, n//p)


def challenge4():
    c = mpz('22096451867410381776306561134883418017410069787892831071731839143676135600120538004282329650473509424343946219751512256' +
            '46583996794288946076454204058156474898801373486412045232522932017648791666640299750918872997169052608322206777160001932' + 
            '9260870009579993724077458967773697817571267229951148662959627934791540')

    n = mpz('17976931348623159077293051907890247336179769789423065727343008115' + 
            '77326758055056206869853794492129829595855013875371640157101398586' +
            '47833778606925583497541085196591615128057575940752635007475935288' +
            '71082364994994077189561705436114947486504671101510156394068052754' +
            '0071584560878577663743040086340742855278549092581')

    e = mpz(65537)

    a = isqrt(n) + 1
    x = isqrt(a**2 - n)

    p = a - x
    q = a + x

    fi = (p-1) * (q-1)

    d = invert(e, fi)

    r = powmod(c, d, n)
    
    m = digits(r, 16).split('00')[1]
    
    return bytes.fromhex(m)

main()